<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Netflix</title>
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js" integrity="sha384-3LK/3kTpDE/Pkp8gTNp2gR/2gOiwQ6QaO7Td0zV76UFJVhqLl4Vl3KL1We6q6wR9" crossorigin="anonymous"></script>

</head>
<body>
  <div class="wrapper">

    <!-- HEADER -->
    <header>
      <div class="netflixLogo">
        <a id="logo" href="accueil.html#home"><img src="../assets/netflix_violet.png" alt="Logo Image"></a>
      </div>
      <nav class="main-nav">                
        <a href="accueil.html">Films/Séries</a>
        <a href="reserver_tout.html">Séances</a>
        <a href=""></a>
      </nav>  

      <nav class="sub-nav">
        <a href="#"><i class=""></i></a>
        <a href="#"><i class=""></i></a>
        <a href="./reserve.html">Compte</a>        
      </nav>      
    </header>
    <!-- END OF HEADER -->
    
    <!-- MAIN CONTAINER -->
    <section class="main-container" >
      <div>
        <section class="film" id="imgback">
          <h1 class="pitch-title"><span id="titre"></span><a onclick="favori()" id="favori"> ★</a></h1>
          <p class="pitch-subtitle" id="resume"></p>
          <a href="watch.html"><button class="btn">Reagarder ►</button></a>
        </section>
      </div>
      
      <div class="location top" id="home">
        <div id="btn">
           <!-- <button class="btn-delete espacebas" id="S1" onclick="saison('S1')">Saison 1</button>
          <button class="btn-delete espacebas" id="S2" onclick="saison('S2')">Saison 2</button>
          <button class="btn-delete espacebas" id="S3" onclick="saison('S3')">Saison 3</button>  -->
        </div>
        <div id="affichage">
          <!-- <div id="Saison1">
            <div class="box" id="episode1">
              <a href=""><img src="../assets/stranger-things-S01.jpg" > Episode 1</a>
              <a href=""><img src="../assets/stranger-things-S01.jpg" > Episode 2</a>
              <a href=""><img src="../assets/stranger-things-S01.jpg" > Episode 3</a>
              <a href=""><img src="../assets/stranger-things-S01.jpg" > Episode 4</a>
              <a href=""><img src="../assets/stranger-things-S01.jpg" > Episode 5</a>
              <a href=""><img src="../assets/stranger-things-S01.jpg" > Episode 6</a>
            </div>
          </div> 
          <div id="Saison2" hidden>
            <div class="box" id="episode1">
              <a href=""><img src="../assets/stranger-things-S02.jpg" > Episode 1</a>
              <a href=""><img src="../assets/stranger-things-S02.jpg" > Episode 2</a>
              <a href=""><img src="../assets/stranger-things-S02.jpg" > Episode 3</a>
              <a href=""><img src="../assets/stranger-things-S02.jpg" > Episode 4</a>
              <a href=""><img src="../assets/stranger-things-S02.jpg" > Episode 5</a>
              <a href=""><img src="../assets/stranger-things-S02.jpg" > Episode 6</a>
            </div>
          </div>            
          <div id="Saison3" hidden>
            <div class="box">
              <a href=""><img src="../assets/stranger-things-S03.jpg" > Episode 1</a>
              <a href=""><img src="../assets/stranger-things-S03.jpg" > Episode 2</a>
              <a href=""><img src="../assets/stranger-things-S03.jpg" > Episode 3</a>
              <a href=""><img src="../assets/stranger-things-S03.jpg" > Episode 4</a>
              <a href=""><img src="../assets/stranger-things-S03.jpg" > Episode 5</a>
              <a href=""><img src="../assets/stranger-things-S03.jpg" > Episode 6</a>
            </div>
          </div> -->
        </div>
      </div>

      <div class="commentaire-fond top">
        <h2 class="commentaire">Commentaire</h2>
        <Textarea rows="5" class="commentaire" placeholder="Faire un commentaire."></Textarea>
        <div><button class="btn center">Commenté</button> </div>
      </div>
    </section>
    <!-- END OF MAIN CONTAINER -->

    <footer>
      <a href="./contact.html" class="flooter">Contact ☎️</a>
    </footer>
  </div>
</body>
</html>
<script>
  Boolean: favoriBoll = false;
  let ancienbtn, favoriId;
  function reserver(){
    window.location.href ="reserver.html?idserie=" + idseries;
  }
  function favori()
  {
    addfavori ='http://localhost/projetM1/projet_Netflix/Controleur/addFavori.php';
    removefavori ='http://localhost/projetM1/projet_Netflix/Controleur/removeFavori.php';

    if (favoriBoll == true) {
      let data = JSON.stringify({
        id: favoriId
      });
      //console.log("data",data);  
      fetch(removefavori,
      {
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
          },
        method: "POST",
        body: data
      })
      .then(function (response) {
        //console.log('reponse',response.status  ,"response",response)
        if (response.status) {
          document.getElementById("favori").style.color = 'white'
          window.location.reload();
        }
      })
      .catch(function (error) {
        console.log("Error: " + error);
      });
    }else{
      let data = JSON.stringify({
        idU: localStorage.getItem("idUser"),
        idF: "null",
        idS: idseries
      });
      //console.log("data",data);  
      fetch(addfavori,
      {
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
          },
        method: "POST",
        body: data
      })
      .then(function (response) {
        //console.log('reponse',response.status  ,"response",response)
        if (response.status) {
          document.getElementById("favori").style.color = '#FFD700'
          window.location.reload();
        }
      })
      .catch(function (error) {
        console.log("Error: " + error);
      });
    }
  }
  function saison(btn, urlimage)
  {
    document.getElementById(btn).style.backgroundColor = "#ffffff80";
    if (ancienbtn != null) {
        document.getElementById(ancienbtn).style.backgroundColor = "#ffffff27";
    }
    ancienbtn = btn;
    if (btn == 'S1') {
      document.getElementById("Saison1").hidden = false;
      document.getElementById("Saison2").hidden = true;
      document.getElementById("Saison3").hidden = true;
      document.getElementById("imgback").style.backgroundImage = 'url('+urlimage+')';
    }else if (btn == 'S2') {
      document.getElementById("Saison1").hidden = true;
      document.getElementById("Saison2").hidden = false;
      document.getElementById("Saison3").hidden = true;
      document.getElementById("imgback").style.backgroundImage = 'url('+urlimage+')';
    }else if (btn == 'S3'){
      document.getElementById("Saison1").hidden = true;
      document.getElementById("Saison2").hidden = true;
      document.getElementById("Saison3").hidden = false;
      document.getElementById("imgback").style.backgroundImage = 'url('+urlimage+')';
    }
  }

  var url = new URL(document.location.href);
  var idseries = url.searchParams.get("series");
  getSeriesPrecis = 'http://localhost/projetm1/projet_Netflix/Controleur/getSeries.php?id='+idseries;
  fetch(getSeriesPrecis)
  .then(function (response) {
      //console.log('reponse',getFilm,"response",response)
    return response.json();
  })
  .then(function (myJson) {
    //console.log(myJson,"ip",myJson);
    myJson.forEach(element => {
      document.getElementById("imgback").style.backgroundImage = "url("+element.lien+")";
      document.getElementById("titre").textContent += element.titre;
      document.getElementById("resume").textContent = element.resume;
  });
  })
  .catch(function (error) {
    console.log("Error: " + error);
  });
  
  getEpisodes ='http://localhost/projetM1/projet_Netflix/Controleur/getEpisodes.php?id='+idseries
  fetch(getEpisodes)
  .then(function (response) {
      //console.log('reponse',getFilm,"response",response)
    return response.json();
  })
  .then(function (myJson) {
    var saison = 0;
    
    for (i = 0; i < myJson[myJson.length-1].saison; i++) {
      let div  = document.createElement('div');
      let divsous  = document.createElement('div');
      let x = i;
      x++;
      div.id="Saison"+x;
      divsous.className="box";
      divsous.id="divsous"+x;
      if (i>=1) {
        div.hidden = true;
      }
      div.append(divsous);
      document.getElementById("affichage").append(div);
    }
    myJson.forEach((element, index)=> {
      if (saison != element.saison) {        
        let button  = document.createElement('button');
        button.className = 'btn-delete espacebas';
        button.textContent = "Saison"+element.saison;
        button.id = "S"+element.saison;
        button.addEventListener("click", () => {
          this.saison("S"+element.saison, element.lien_image);
        });
        document.getElementById("btn").append(button);
        saison = element.saison;
      }
      let a  = document.createElement('a');
      let img  = document.createElement('img');
      img.src = element.lien_image;
      a.textContent = element.nom;
      a.append(img);
      switch (element.saison) {
        case "1":
          document.getElementById("divsous1").appendChild(a);
          break;
        case "2":
          document.getElementById("divsous2").appendChild(a)
          break;
        case "3":
          document.getElementById("divsous3").appendChild(a)
          break; 
        default:
          break;
      }
  });
  })
  .catch(function (error) {
    console.log("Error: " + error);
  });
  //get favori
  getFavori = 'http://localhost/projetm1/projet_Netflix/Controleur/getFav.php';
  let data = JSON.stringify({
    idUser: localStorage.getItem("idUser"),
    idSeance: idseries,
    idFilm: "null"
    });
  fetch(getFavori,
    {
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
        },
      method: "POST",
      body: data
    })
  .then(function (response) {
      //console.log('reponse',getFilm,"response",response)
    return response.json();
  })
  .then(function (myJson) {
    //console.log(myJson,"ip",myJson);
    myJson.forEach(element => {
      if (localStorage.getItem("idUser") == element.idUtilisateur) {
        document.getElementById("favori").style.color = '#FFD700';
        favoriBoll = true;
        favoriId= element.id;
      }
    });
  })
  .catch(function (error) {
    console.log("Error: " + error);
  });
</script>